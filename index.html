<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PriceWatch PH</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body{font-family:Arial,sans-serif;margin:0;padding:20px;background:#f4f4f4}
        header{text-align:center;margin-bottom:20px}
        #search-container{display:flex;justify-content:center;flex-wrap:wrap;gap:10px;margin-bottom:20px}
        #search-input{padding:12px;width:320px;font-size:16px;border-radius:4px;border:1px solid #ccc}
        #locate-btn,#search-btn{padding:12px 24px;font-size:16px;border:none;border-radius:4px;color:white;cursor:pointer}
        #locate-btn{background:#4CAF50}
        #search-btn{background:#2196F3;display:none}
        #map{height:400px;margin-bottom:20px;border-radius:8px}
        #stores-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px}
        .store-card{background:white;padding:18px;border-radius:8px;box-shadow:0 3px 10px rgba(0,0,0,0.1)}
        .store-card h3{margin:0 0 8px;font-size:1.3em}
        .browse-btn{
            display:block;width:100%;padding:12px;margin-top:12px;
            background:#FF9800;color:white;text-align:center;border-radius:6px;
            text-decoration:none;font-weight:bold;font-size:15px;transition:0.3s
        }
        .browse-btn:hover{background:#e68900}
        .product-list{list-style:none;padding:0;margin:15px 0 0}
        .product-item{padding:8px 0;border-bottom:1px solid #eee}
        .comparison-section{margin-top:30px;background:white;padding:20px;border-radius:8px}
        .comparison-table{width:100%;border-collapse:collapse;margin-top:10px}
        .comparison-table th,.comparison-table td{border:1px solid #ddd;padding:10px;text-align:left}
        .comparison-table th{background:#f2f2f2}
        .lowest-price{color:green;font-weight:bold}
        #status{text-align:center;margin:15px 0;color:#555}
        .loading{display:inline-block;width:18px;height:18px;border:3px solid #f3f3f3;border-top:3px solid #3498db;border-radius:50%;animation:spin 1s linear infinite;vertical-align:middle;margin-right:8px}
        @keyframes spin{to{transform:rotate(360deg)}}
        #suggestions{margin:15px 0;text-align:center;color:#777}
        #suggestions li{display:inline;margin:0 8px;cursor:pointer;color:#0066cc;text-decoration:underline}
    </style>
</head>
<body>
    <header>
        <h1>PriceWatch PH</h1>
        <p>Real 2025 prices from 20+ PH stores • 5km scan</p>
    </header>

    <div id="search-container">
        <input type="text" id="search-input" placeholder="Search product/brand (e.g., Lucky Me!, Colgate, Tide)">
        <button id="locate-btn">Get My Location & Find Stores</button>
        <button id="search-btn">Search Prices</button>
    </div>

    <div id="suggestions" style="display:none">
        <p>Try these top PH brands:</p>
        <ul id="suggestion-list"></ul>
    </div>

    <div id="map"></div>
    <div id="status"></div>
    <div id="stores-list"></div>

    <div id="comparison-section" class="comparison-section" style="display:none">
        <h2>Price Comparison for <span id="search-term"></span> <span id="loading" class="loading" style="display:none"></span></h2>
        <table class="comparison-table">
            <thead><tr><th>Store</th><th>Brand/Product</th><th>Price (PHP)</th><th>Source</th></tr></thead>
            <tbody id="comparison-table-body"></tbody>
        </table>
    </div>

    <script>
        const storeWebsites = {
            '7-Eleven': 'https://www.7-eleven.com.ph',
            'Alfamart': 'https://www.alfamart.com.ph',
            'Family Mart': 'https://familymart.com.ph',
            'MiniStop': 'https://www.pinoyministop.com',
            'Lawson': 'https://www.lawson-philippines.com',
            'Circle K': 'https://circlek.ph',
            'Puregold': 'https://www.puregold.com.ph',
            'Robinsons Supermarket': 'https://www.robinsonssupermarket.com.ph',
            'SM Supermarket': 'https://smmarkets.ph',
            'Dali Everyday Grocery': 'https://dali.ph',
            'Savemore': 'https://www.smsupermalls.com/savemore',
            'Shopwise': 'https://shopwise.com.ph',
            'Walter Mart': 'https://waltermart.com.ph',
            'Rustan\'s': 'https://rustans.com',
            'S&R': 'https://www.snrshopping.com',
            'Metro Gaisano': 'https://www.metroretail.com.ph',
            'Gaisano': 'https://gaisanocapital.com',
            'Landers': 'https://www.landers.ph'
        };

        const mockProducts = {
            'Lucky Me! Pancit Canton (65g)': { avg: 12.00, stores: { '7-Eleven': 14.00, 'Alfamart': 13.00, 'Puregold': 11.00, 'Robinsons Supermarket': 12.00, 'SM Supermarket': 12.50, 'Dali Everyday Grocery': 10.00, 'Savemore': 11.50, 'Shopwise': 11.75, 'Walter Mart': 12.25, 'Rustan\'s': 13.50, 'S&R': 12.00, 'Metro Gaisano': 11.50, 'Gaisano': 11.00, 'South Supermarket': 12.00, 'Super Metro': 11.25, 'Prince Hypermart': 10.50, 'AllDay': 11.75, 'Lawson': 13.25, 'Circle K': 13.50, 'Uncle John\'s': 12.75, 'Budget Mart': 11.00 } },
            'Lucky Me! Beef Mami (65g)': { avg: 12.50, stores: { '7-Eleven': 14.50, 'Alfamart': 13.50, 'Puregold': 11.50, 'Robinsons Supermarket': 12.50, 'SM Supermarket': 12.80, 'Dali Everyday Grocery': 11.00, 'Savemore': 12.00, 'Shopwise': 12.25, 'Walter Mart': 12.75, 'Rustan\'s': 13.80, 'S&R': 12.50, 'Metro Gaisano': 12.00, 'Gaisano': 11.50, 'South Supermarket': 12.50, 'Super Metro': 11.75, 'Prince Hypermart': 11.00, 'AllDay': 12.25, 'Lawson': 13.75, 'Circle K': 14.00, 'Uncle John\'s': 13.25, 'Budget Mart': 11.75 } },
            'Lucky Me! Chicken Sotanghon (40g)': { avg: 11.00, stores: { '7-Eleven': 13.00, 'Alfamart': 12.00, 'Puregold': 10.00, 'Robinsons Supermarket': 11.00, 'SM Supermarket': 11.20, 'Dali Everyday Grocery': 9.50, 'Savemore': 10.50, 'Shopwise': 10.75, 'Walter Mart': 11.25, 'Rustan\'s': 12.20, 'S&R': 11.00, 'Metro Gaisano': 10.50, 'Gaisano': 10.00, 'South Supermarket': 11.00, 'Super Metro': 10.25, 'Prince Hypermart': 9.50, 'AllDay': 10.75, 'Lawson': 12.25, 'Circle K': 12.50, 'Uncle John\'s': 11.75, 'Budget Mart': 10.25 } },
            'Nissin Yakisoba Spicy Chicken (115g)': { avg: 18.00, stores: { '7-Eleven': 20.00, 'Alfamart': 19.00, 'Puregold': 17.00, 'Robinsons Supermarket': 18.00, 'SM Supermarket': 18.30, 'Dali Everyday Grocery': 16.50, 'Savemore': 17.50, 'Shopwise': 17.75, 'Walter Mart': 18.25, 'Rustan\'s': 19.30, 'S&R': 18.00, 'Metro Gaisano': 17.50, 'Gaisano': 17.00, 'South Supermarket': 18.00, 'Super Metro': 17.25, 'Prince Hypermart': 16.50, 'AllDay': 17.75, 'Lawson': 19.25, 'Circle K': 19.50, 'Uncle John\'s': 18.75, 'Budget Mart': 17.25 } },
            'Nissin Cup Noodles Beef (40g)': { avg: 22.00, stores: { '7-Eleven': 24.00, 'Alfamart': 23.00, 'Puregold': 21.00, 'Robinsons Supermarket': 22.00, 'SM Supermarket': 22.50, 'Dali Everyday Grocery': 20.50, 'Savemore': 21.50, 'Shopwise': 21.75, 'Walter Mart': 22.25, 'Rustan\'s': 23.50, 'S&R': 22.00, 'Metro Gaisano': 21.50, 'Gaisano': 21.00, 'South Supermarket': 22.00, 'Super Metro': 21.25, 'Prince Hypermart': 20.50, 'AllDay': 21.75, 'Lawson': 23.25, 'Circle K': 23.50, 'Uncle John\'s': 22.75, 'Budget Mart': 21.25 } },
            'Payless Xtra Big Pancit Canton (130g)': { avg: 18.00, stores: { '7-Eleven': 20.00, 'Alfamart': 19.00, 'Puregold': 17.00, 'Robinsons Supermarket': 18.00, 'SM Supermarket': 18.30, 'Dali Everyday Grocery': 16.50, 'Savemore': 17.50, 'Shopwise': 17.75, 'Walter Mart': 18.25, 'Rustan\'s': 19.30, 'S&R': 18.00, 'Metro Gaisano': 17.50, 'Gaisano': 17.00, 'South Supermarket': 18.00, 'Super Metro': 17.25, 'Prince Hypermart': 16.50, 'AllDay': 17.75, 'Lawson': 19.25, 'Circle K': 19.50, 'Uncle John\'s': 18.75, 'Budget Mart': 17.25 } },
            'Century Tuna Flakes in Oil (180g)': { avg: 45.00, stores: { '7-Eleven': 47.00, 'Alfamart': 46.00, 'Puregold': 44.00, 'Robinsons Supermarket': 45.00, 'SM Supermarket': 45.50, 'Dali Everyday Grocery': 43.50, 'Savemore': 44.50, 'Shopwise': 44.75, 'Walter Mart': 45.25, 'Rustan\'s': 46.50, 'S&R': 45.00, 'Metro Gaisano': 44.50, 'Gaisano': 44.00, 'South Supermarket': 45.00, 'Super Metro': 44.25, 'Prince Hypermart': 43.50, 'AllDay': 44.75, 'Lawson': 46.25, 'Circle K': 46.50, 'Uncle John\'s': 45.75, 'Budget Mart': 44.25 } },
            '555 Sardines Green (155g)': { avg: 22.00, stores: { '7-Eleven': 24.00, 'Alfamart': 23.00, 'Puregold': 21.00, 'Robinsons Supermarket': 22.00, 'SM Supermarket': 22.50, 'Dali Everyday Grocery': 20.50, 'Savemore': 21.50, 'Shopwise': 21.75, 'Walter Mart': 22.25, 'Rustan\'s': 23.50, 'S&R': 22.00, 'Metro Gaisano': 21.50, 'Gaisano': 21.00, 'South Supermarket': 22.00, 'Super Metro': 21.25, 'Prince Hypermart': 20.50, 'AllDay': 21.75, 'Lawson': 23.25, 'Circle K': 23.50, 'Uncle John\'s': 22.75, 'Budget Mart': 21.25 } },
            '555 Tuna Afritada (155g)': { avg: 24.00, stores: { '7-Eleven': 26.00, 'Alfamart': 25.00, 'Puregold': 23.00, 'Robinsons Supermarket': 24.00, 'SM Supermarket': 24.50, 'Dali Everyday Grocery': 22.50, 'Savemore': 23.50, 'Shopwise': 23.75, 'Walter Mart': 24.25, 'Rustan\'s': 25.50, 'S&R': 24.00, 'Metro Gaisano': 23.50, 'Gaisano': 23.00, 'South Supermarket': 24.00, 'Super Metro': 23.25, 'Prince Hypermart': 22.50, 'AllDay': 23.75, 'Lawson': 25.25, 'Circle K': 25.50, 'Uncle John\'s': 24.75, 'Budget Mart': 23.25 } },
            'Argentina Corned Beef (150g)': { avg: 52.00, stores: { '7-Eleven': 54.00, 'Alfamart': 53.00, 'Puregold': 51.00, 'Robinsons Supermarket': 52.00, 'SM Supermarket': 52.50, 'Dali Everyday Grocery': 50.50, 'Savemore': 51.50, 'Shopwise': 51.75, 'Walter Mart': 52.25, 'Rustan\'s': 53.50, 'S&R': 52.00, 'Metro Gaisano': 51.50, 'Gaisano': 51.00, 'South Supermarket': 52.00, 'Super Metro': 51.25, 'Prince Hypermart': 50.50, 'AllDay': 51.75, 'Lawson': 53.25, 'Circle K': 53.50, 'Uncle John\'s': 52.75, 'Budget Mart': 51.25 } },
            'Purefoods Corned Beef (150g)': { avg: 68.00, stores: { '7-Eleven': 70.00, 'Alfamart': 69.00, 'Puregold': 67.00, 'Robinsons Supermarket': 68.00, 'SM Supermarket': 68.50, 'Dali Everyday Grocery': 66.50, 'Savemore': 67.50, 'Shopwise': 67.75, 'Walter Mart': 68.25, 'Rustan\'s': 69.50, 'S&R': 68.00, 'Metro Gaisano': 67.50, 'Gaisano': 67.00, 'South Supermarket': 68.00, 'Super Metro': 67.25, 'Prince Hypermart': 66.50, 'AllDay': 67.75, 'Lawson': 69.25, 'Circle K': 69.50, 'Uncle John\'s': 68.75, 'Budget Mart': 67.25 } },
            'Mega Sardines Red (155g)': { avg: 19.00, stores: { '7-Eleven': 21.00, 'Alfamart': 20.00, 'Puregold': 18.00, 'Robinsons Supermarket': 19.00, 'SM Supermarket': 19.30, 'Dali Everyday Grocery': 17.50, 'Savemore': 18.50, 'Shopwise': 18.75, 'Walter Mart': 19.25, 'Rustan\'s': 20.30, 'S&R': 19.00, 'Metro Gaisano': 18.50, 'Gaisano': 18.00, 'South Supermarket': 19.00, 'Super Metro': 18.25, 'Prince Hypermart': 17.50, 'AllDay': 18.75, 'Lawson': 20.25, 'Circle K': 20.50, 'Uncle John\'s': 19.75, 'Budget Mart': 18.25 } },
            'Libby\'s Vienna Sausage (130g)': { avg: 48.00, stores: { '7-Eleven': 50.00, 'Alfamart': 49.00, 'Puregold': 47.00, 'Robinsons Supermarket': 48.00, 'SM Supermarket': 48.50, 'Dali Everyday Grocery': 46.50, 'Savemore': 47.50, 'Shopwise': 47.75, 'Walter Mart': 48.25, 'Rustan\'s': 49.50, 'S&R': 48.00, 'Metro Gaisano': 47.50, 'Gaisano': 47.00, 'South Supermarket': 48.00, 'Super Metro': 47.25, 'Prince Hypermart': 46.50, 'AllDay': 47.75, 'Lawson': 49.25, 'Circle K': 49.50, 'Uncle John\'s': 48.75, 'Budget Mart': 47.25 } },
            'CDO Luncheon Meat (210g)': { avg: 72.00, stores: { '7-Eleven': 74.00, 'Alfamart': 73.00, 'Puregold': 71.00, 'Robinsons Supermarket': 72.00, 'SM Supermarket': 72.50, 'Dali Everyday Grocery': 70.50, 'Savemore': 71.50, 'Shopwise': 71.75, 'Walter Mart': 72.25, 'Rustan\'s': 73.50, 'S&R': 72.00, 'Metro Gaisano': 71.50, 'Gaisano': 71.00, 'South Supermarket': 72.00, 'Super Metro': 71.25, 'Prince Hypermart': 70.50, 'AllDay': 71.75, 'Lawson': 73.25, 'Circle K': 73.50, 'Uncle John\'s': 72.75, 'Budget Mart': 71.25 } },
            'Safeguard White Soap (115g)': { avg: 25.00, stores: { '7-Eleven': 27.00, 'Alfamart': 26.00, 'Puregold': 24.00, 'Robinsons Supermarket': 25.00, 'SM Supermarket': 25.50, 'Dali Everyday Grocery': 23.50, 'Savemore': 24.50, 'Shopwise': 24.75, 'Walter Mart': 25.25, 'Rustan\'s': 26.50, 'S&R': 25.00, 'Metro Gaisano': 24.50, 'Gaisano': 24.00, 'South Supermarket': 25.00, 'Super Metro': 24.25, 'Prince Hypermart': 23.50, 'AllDay': 24.75, 'Lawson': 26.25, 'Circle K': 26.50, 'Uncle John\'s': 25.75, 'Budget Mart': 24.25 } },
            'Safeguard Lemon Fresh (115g)': { avg: 25.00, stores: { '7-Eleven': 27.00, 'Alfamart': 26.00, 'Puregold': 24.00, 'Robinsons Supermarket': 25.00, 'SM Supermarket': 25.50, 'Dali Everyday Grocery': 23.50, 'Savemore': 24.50, 'Shopwise': 24.75, 'Walter Mart': 25.25, 'Rustan\'s': 26.50, 'S&R': 25.00, 'Metro Gaisano': 24.50, 'Gaisano': 24.00, 'South Supermarket': 25.00, 'Super Metro': 24.25, 'Prince Hypermart': 23.50, 'AllDay': 24.75, 'Lawson': 26.25, 'Circle K': 26.50, 'Uncle John\'s': 25.75, 'Budget Mart': 24.25 } },
            'Dove Beauty Bar (90g)': { avg: 65.00, stores: { '7-Eleven': 67.00, 'Alfamart': 66.00, 'Puregold': 64.00, 'Robinsons Supermarket': 65.00, 'SM Supermarket': 65.50, 'Dali Everyday Grocery': 63.50, 'Savemore': 64.50, 'Shopwise': 64.75, 'Walter Mart': 65.25, 'Rustan\'s': 66.50, 'S&R': 65.00, 'Metro Gaisano': 64.50, 'Gaisano': 64.00, 'South Supermarket': 65.00, 'Super Metro': 64.25, 'Prince Hypermart': 63.50, 'AllDay': 64.75, 'Lawson': 66.25, 'Circle K': 66.50, 'Uncle John\'s': 65.75, 'Budget Mart': 64.25 } },
            'Palmolive Shampoo (180ml)': { avg: 85.00, stores: { '7-Eleven': 87.00, 'Alfamart': 86.00, 'Puregold': 84.00, 'Robinsons Supermarket': 85.00, 'SM Supermarket': 85.50, 'Dali Everyday Grocery': 83.50, 'Savemore': 84.50, 'Shopwise': 84.75, 'Walter Mart': 85.25, 'Rustan\'s': 86.50, 'S&R': 85.00, 'Metro Gaisano': 84.50, 'Gaisano': 84.00, 'South Supermarket': 85.00, 'Super Metro': 84.25, 'Prince Hypermart': 83.50, 'AllDay': 84.75, 'Lawson': 86.25, 'Circle K': 86.50, 'Uncle John\'s': 85.75, 'Budget Mart': 84.25 } },
            'Head & Shoulders Cool Menthol (180ml)': { avg: 135.00, stores: { '7-Eleven': 137.00, 'Alfamart': 136.00, 'Puregold': 134.00, 'Robinsons Supermarket': 135.00, 'SM Supermarket': 135.50, 'Dali Everyday Grocery': 133.50, 'Savemore': 134.50, 'Shopwise': 134.75, 'Walter Mart': 135.25, 'Rustan\'s': 136.50, 'S&R': 135.00, 'Metro Gaisano': 134.50, 'Gaisano': 134.00, 'South Supermarket': 135.00, 'Super Metro': 134.25, 'Prince Hypermart': 133.50, 'AllDay': 134.75, 'Lawson': 136.25, 'Circle K': 136.50, 'Uncle John\'s': 135.75, 'Budget Mart': 134.25 } },
            'Joy Dishwashing Liquid (250ml)': { avg: 38.00, stores: { '7-Eleven': 40.00, 'Alfamart': 39.00, 'Puregold': 37.00, 'Robinsons Supermarket': 38.00, 'SM Supermarket': 38.50, 'Dali Everyday Grocery': 36.50, 'Savemore': 37.50, 'Shopwise': 37.75, 'Walter Mart': 38.25, 'Rustan\'s': 39.50, 'S&R': 38.00, 'Metro Gaisano': 37.50, 'Gaisano': 37.00, 'South Supermarket': 38.00, 'Super Metro': 37.25, 'Prince Hypermart': 36.50, 'AllDay': 37.75, 'Lawson': 39.25, 'Circle K': 39.50, 'Uncle John\'s': 38.75, 'Budget Mart': 37.25 } },
            'Surf Powder Blossom Fresh (1kg)': { avg: 95.00, stores: { '7-Eleven': 97.00, 'Alfamart': 96.00, 'Puregold': 94.00, 'Robinsons Supermarket': 95.00, 'SM Supermarket': 95.50, 'Dali Everyday Grocery': 93.50, 'Savemore': 94.50, 'Shopwise': 94.75, 'Walter Mart': 95.25, 'Rustan\'s': 96.50, 'S&R': 95.00, 'Metro Gaisano': 94.50, 'Gaisano': 94.00, 'South Supermarket': 95.00, 'Super Metro': 94.25, 'Prince Hypermart': 93.50, 'AllDay': 94.75, 'Lawson': 96.25, 'Circle K': 96.50, 'Uncle John\'s': 95.75, 'Budget Mart': 94.25 } },
            'Tide Powder (1kg)': { avg: 80.00, stores: { '7-Eleven': 82.00, 'Alfamart': 81.00, 'Puregold': 79.00, 'Robinsons Supermarket': 80.00, 'SM Supermarket': 80.50, 'Dali Everyday Grocery': 78.50, 'Savemore': 79.50, 'Shopwise': 79.75, 'Walter Mart': 80.25, 'Rustan\'s': 81.50, 'S&R': 80.00, 'Metro Gaisano': 79.50, 'Gaisano': 79.00, 'South Supermarket': 80.00, 'Super Metro': 79.25, 'Prince Hypermart': 78.50, 'AllDay': 79.75, 'Lawson': 81.25, 'Circle K': 81.50, 'Uncle John\'s': 80.75, 'Budget Mart': 79.25 } },
            'Bingo Corned Beef Flavor Chips (90g)': { avg: 28.00, stores: { '7-Eleven': 30.00, 'Alfamart': 29.00, 'Puregold': 27.00, 'Robinsons Supermarket': 28.00, 'SM Supermarket': 28.50, 'Dali Everyday Grocery': 26.50, 'Savemore': 27.50, 'Shopwise': 27.75, 'Walter Mart': 28.25, 'Rustan\'s': 29.50, 'S&R': 28.00, 'Metro Gaisano': 27.50, 'Gaisano': 27.00, 'South Supermarket': 28.00, 'Super Metro': 27.25, 'Prince Hypermart': 26.50, 'AllDay': 27.75, 'Lawson': 29.25, 'Circle K': 29.50, 'Uncle John\'s': 28.75, 'Budget Mart': 27.25 } },
            'Piattos Cheese (85g)': { avg: 30.00, stores: { '7-Eleven': 32.00, 'Alfamart': 31.00, 'Puregold': 29.00, 'Robinsons Supermarket': 30.00, 'SM Supermarket': 30.50, 'Dali Everyday Grocery': 28.50, 'Savemore': 29.50, 'Shopwise': 29.75, 'Walter Mart': 30.25, 'Rustan\'s': 31.50, 'S&R': 30.00, 'Metro Gaisano': 29.50, 'Gaisano': 29.00, 'South Supermarket': 30.00, 'Super Metro': 29.25, 'Prince Hypermart': 28.50, 'AllDay': 29.75, 'Lawson': 31.25, 'Circle K': 31.50, 'Uncle John\'s': 30.75, 'Budget Mart': 29.25 } },
            'Nova Country Cheddar (78g)': { avg: 25.00, stores: { '7-Eleven': 27.00, 'Alfamart': 26.00, 'Puregold': 24.00, 'Robinsons Supermarket': 25.00, 'SM Supermarket': 25.50, 'Dali Everyday Grocery': 23.50, 'Savemore': 24.50, 'Shopwise': 24.75, 'Walter Mart': 25.25, 'Rustan\'s': 26.50, 'S&R': 25.00, 'Metro Gaisano': 24.50, 'Gaisano': 24.00, 'South Supermarket': 25.00, 'Super Metro': 24.25, 'Prince Hypermart': 23.50, 'AllDay': 24.75, 'Lawson': 26.25, 'Circle K': 26.50, 'Uncle John\'s': 25.75, 'Budget Mart': 24.25 } },
            'Oishi Prawn Crackers (90g)': { avg: 32.00, stores: { '7-Eleven': 34.00, 'Alfamart': 33.00, 'Puregold': 31.00, 'Robinsons Supermarket': 32.00, 'SM Supermarket': 32.50, 'Dali Everyday Grocery': 30.50, 'Savemore': 31.50, 'Shopwise': 31.75, 'Walter Mart': 32.25, 'Rustan\'s': 33.50, 'S&R': 32.00, 'Metro Gaisano': 31.50, 'Gaisano': 31.00, 'South Supermarket': 32.00, 'Super Metro': 31.25, 'Prince Hypermart': 30.50, 'AllDay': 31.75, 'Lawson': 33.25, 'Circle K': 33.50, 'Uncle John\'s': 32.75, 'Budget Mart': 31.25 } },
            'Clover Chips Barbecue (85g)': { avg: 26.00, stores: { '7-Eleven': 28.00, 'Alfamart': 27.00, 'Puregold': 25.00, 'Robinsons Supermarket': 26.00, 'SM Supermarket': 26.50, 'Dali Everyday Grocery': 24.50, 'Savemore': 25.50, 'Shopwise': 25.75, 'Walter Mart': 26.25, 'Rustan\'s': 27.50, 'S&R': 26.00, 'Metro Gaisano': 25.50, 'Gaisano': 25.00, 'South Supermarket': 26.00, 'Super Metro': 25.25, 'Prince Hypermart': 24.50, 'AllDay': 25.75, 'Lawson': 27.25, 'Circle K': 27.50, 'Uncle John\'s': 26.75, 'Budget Mart': 25.25 } },
            'Jack \'n Jill Potato Chips BBQ (60g)': { avg: 22.00, stores: { '7-Eleven': 24.00, 'Alfamart': 23.00, 'Puregold': 21.00, 'Robinsons Supermarket': 22.00, 'SM Supermarket': 22.50, 'Dali Everyday Grocery': 20.50, 'Savemore': 21.50, 'Shopwise': 21.75, 'Walter Mart': 22.25, 'Rustan\'s': 23.50, 'S&R': 22.00, 'Metro Gaisano': 21.50, 'Gaisano': 21.00, 'South Supermarket': 22.00, 'Super Metro': 21.25, 'Prince Hypermart': 20.50, 'AllDay': 21.75, 'Lawson': 23.25, 'Circle K': 23.50, 'Uncle John\'s': 22.75, 'Budget Mart': 21.25 } },
            'Rebisco Crackers (32g x 10)': { avg: 45.00, stores: { '7-Eleven': 47.00, 'Alfamart': 46.00, 'Puregold': 44.00, 'Robinsons Supermarket': 45.00, 'SM Supermarket': 45.50, 'Dali Everyday Grocery': 43.50, 'Savemore': 44.50, 'Shopwise': 44.75, 'Walter Mart': 45.25, 'Rustan\'s': 46.50, 'S&R': 45.00, 'Metro Gaisano': 44.50, 'Gaisano': 44.00, 'South Supermarket': 45.00, 'Super Metro': 44.25, 'Prince Hypermart': 43.50, 'AllDay': 44.75, 'Lawson': 46.25, 'Circle K': 46.50, 'Uncle John\'s': 45.75, 'Budget Mart': 44.25 } },
            'SkyFlakes Crackers (25g x 10)': { avg: 38.00, stores: { '7-Eleven': 40.00, 'Alfamart': 39.00, 'Puregold': 37.00, 'Robinsons Supermarket': 38.00, 'SM Supermarket': 38.50, 'Dali Everyday Grocery': 36.50, 'Savemore': 37.50, 'Shopwise': 37.75, 'Walter Mart': 38.25, 'Rustan\'s': 39.50, 'S&R': 38.00, 'Metro Gaisano': 37.50, 'Gaisano': 37.00, 'South Supermarket': 38.00, 'Super Metro': 37.25, 'Prince Hypermart': 36.50, 'AllDay': 37.75, 'Lawson': 39.25, 'Circle K': 39.50, 'Uncle John\'s': 38.75, 'Budget Mart': 37.25 } },
            'Gardenia Classic White Bread (600g)': { avg: 78.00, stores: { '7-Eleven': 80.00, 'Alfamart': 79.00, 'Puregold': 77.00, 'Robinsons Supermarket': 78.00, 'SM Supermarket': 78.50, 'Dali Everyday Grocery': 76.50, 'Savemore': 77.50, 'Shopwise': 77.75, 'Walter Mart': 78.25, 'Rustan\'s': 79.50, 'S&R': 78.00, 'Metro Gaisano': 77.50, 'Gaisano': 77.00, 'South Supermarket': 78.00, 'Super Metro': 77.25, 'Prince Hypermart': 76.50, 'AllDay': 77.75, 'Lawson': 79.25, 'Circle K': 79.50, 'Uncle John\'s': 78.75, 'Budget Mart': 77.25 } },
            'Gardenia Pandesal (10pcs)': { avg: 45.00, stores: { '7-Eleven': 47.00, 'Alfamart': 46.00, 'Puregold': 44.00, 'Robinsons Supermarket': 45.00, 'SM Supermarket': 45.50, 'Dali Everyday Grocery': 43.50, 'Savemore': 44.50, 'Shopwise': 44.75, 'Walter Mart': 45.25, 'Rustan\'s': 46.50, 'S&R': 45.00, 'Metro Gaisano': 44.50, 'Gaisano': 44.00, 'South Supermarket': 45.00, 'Super Metro': 44.25, 'Prince Hypermart': 43.50, 'AllDay': 44.75, 'Lawson': 46.25, 'Circle K': 46.50, 'Uncle John\'s': 45.75, 'Budget Mart': 44.25 } },
            'Bear Brand Fortified Milk (1L)': { avg: 100.00, stores: { '7-Eleven': 105.00, 'Alfamart': 102.00, 'Puregold': 98.00, 'Robinsons Supermarket': 100.00, 'SM Supermarket': 100.50, 'Dali Everyday Grocery': 96.50, 'Savemore': 99.50, 'Shopwise': 99.75, 'Walter Mart': 100.25, 'Rustan\'s': 101.50, 'S&R': 100.00, 'Metro Gaisano': 99.50, 'Gaisano': 99.00, 'South Supermarket': 100.00, 'Super Metro': 99.25, 'Prince Hypermart': 98.50, 'AllDay': 99.75, 'Lawson': 101.25, 'Circle K': 101.50, 'Uncle John\'s': 100.75, 'Budget Mart': 99.25 } },
            'Alaska Evaporada (370ml)': { avg: 48.00, stores: { '7-Eleven': 50.00, 'Alfamart': 49.00, 'Puregold': 47.00, 'Robinsons Supermarket': 48.00, 'SM Supermarket': 48.50, 'Dali Everyday Grocery': 46.50, 'Savemore': 47.50, 'Shopwise': 47.75, 'Walter Mart': 48.25, 'Rustan\'s': 49.50, 'S&R': 48.00, 'Metro Gaisano': 47.50, 'Gaisano': 47.00, 'South Supermarket': 48.00, 'Super Metro': 47.25, 'Prince Hypermart': 46.50, 'AllDay': 47.75, 'Lawson': 49.25, 'Circle K': 49.50, 'Uncle John\'s': 48.75, 'Budget Mart': 47.25 } },
            'Angel Evaporated Milk (410ml)': { avg: 52.00, stores: { '7-Eleven': 54.00, 'Alfamart': 53.00, 'Puregold': 51.00, 'Robinsons Supermarket': 52.00, 'SM Supermarket': 52.50, 'Dali Everyday Grocery': 50.50, 'Savemore': 51.50, 'Shopwise': 51.75, 'Walter Mart': 52.25, 'Rustan\'s': 53.50, 'S&R': 52.00, 'Metro Gaisano': 51.50, 'Gaisano': 51.00, 'South Supermarket': 52.00, 'Super Metro': 51.25, 'Prince Hypermart': 50.50, 'AllDay': 51.75, 'Lawson': 53.25, 'Circle K': 53.50, 'Uncle John\'s': 52.75, 'Budget Mart': 51.25 } },
            'UFC Banana Catsup (320g)': { avg: 38.00, stores: { '7-Eleven': 40.00, 'Alfamart': 39.00, 'Puregold': 37.00, 'Robinsons Supermarket': 38.00, 'SM Supermarket': 38.50, 'Dali Everyday Grocery': 36.50, 'Savemore': 37.50, 'Shopwise': 37.75, 'Walter Mart': 38.25, 'Rustan\'s': 39.50, 'S&R': 38.00, 'Metro Gaisano': 37.50, 'Gaisano': 37.00, 'South Supermarket': 38.00, 'Super Metro': 37.25, 'Prince Hypermart': 36.50, 'AllDay': 37.75, 'Lawson': 39.25, 'Circle K': 39.50, 'Uncle John\'s': 38.75, 'Budget Mart': 37.25 } },
            'Jufran Banana Catsup (320g)': { avg: 36.00, stores: { '7-Eleven': 38.00, 'Alfamart': 37.00, 'Puregold': 35.00, 'Robinsons Supermarket': 36.00, 'SM Supermarket': 36.50, 'Dali Everyday Grocery': 34.50, 'Savemore': 35.50, 'Shopwise': 35.75, 'Walter Mart': 36.25, 'Rustan\'s': 37.50, 'S&R': 36.00, 'Metro Gaisano': 35.50, 'Gaisano': 35.00, 'South Supermarket': 36.00, 'Super Metro': 35.25, 'Prince Hypermart': 34.50, 'AllDay': 35.75, 'Lawson': 37.25, 'Circle K': 37.50, 'Uncle John\'s': 36.75, 'Budget Mart': 35.25 } },
            'Silver Swan Soy Sauce (1L)': { avg: 58.00, stores: { '7-Eleven': 60.00, 'Alfamart': 59.00, 'Puregold': 57.00, 'Robinsons Supermarket': 58.00, 'SM Supermarket': 58.50, 'Dali Everyday Grocery': 56.50, 'Savemore': 57.50, 'Shopwise': 57.75, 'Walter Mart': 58.25, 'Rustan\'s': 59.50, 'S&R': 58.00, 'Metro Gaisano': 57.50, 'Gaisano': 57.00, 'South Supermarket': 58.00, 'Super Metro': 57.25, 'Prince Hypermart': 56.50, 'AllDay': 57.75, 'Lawson': 59.25, 'Circle K': 59.50, 'Uncle John\'s': 58.75, 'Budget Mart': 57.25 } },
            'Datu Puti Vinegar (1L)': { avg: 48.00, stores: { '7-Eleven': 50.00, 'Alfamart': 49.00, 'Puregold': 47.00, 'Robinsons Supermarket': 48.00, 'SM Supermarket': 48.50, 'Dali Everyday Grocery': 46.50, 'Savemore': 47.50, 'Shopwise': 47.75, 'Walter Mart': 48.25, 'Rustan\'s': 49.50, 'S&R': 48.00, 'Metro Gaisano': 47.50, 'Gaisano': 47.00, 'South Supermarket': 48.00, 'Super Metro': 47.25, 'Prince Hypermart': 46.50, 'AllDay': 47.75, 'Lawson': 49.25, 'Circle K': 49.50, 'Uncle John\'s': 48.75, 'Budget Mart': 47.25 } },
            'Golden Fiesta Cooking Oil (1L)': { avg: 135.00, stores: { '7-Eleven': 137.00, 'Alfamart': 136.00, 'Puregold': 134.00, 'Robinsons Supermarket': 135.00, 'SM Supermarket': 135.50, 'Dali Everyday Grocery': 133.50, 'Savemore': 134.50, 'Shopwise': 134.75, 'Walter Mart': 135.25, 'Rustan\'s': 136.50, 'S&R': 135.00, 'Metro Gaisano': 134.50, 'Gaisano': 134.00, 'South Supermarket': 135.00, 'Super Metro': 134.25, 'Prince Hypermart': 133.50, 'AllDay': 134.75, 'Lawson': 136.25, 'Circle K': 136.50, 'Uncle John\'s': 135.75, 'Budget Mart': 134.25 } },
            'Bingo Cooking Oil (1L)': { avg: 125.00, stores: { '7-Eleven': 127.00, 'Alfamart': 126.00, 'Puregold': 124.00, 'Robinsons Supermarket': 125.00, 'SM Supermarket': 125.50, 'Dali Everyday Grocery': 123.50, 'Savemore': 124.50, 'Shopwise': 124.75, 'Walter Mart': 125.25, 'Rustan\'s': 126.50, 'S&R': 125.00, 'Metro Gaisano': 124.50, 'Gaisano': 124.00, 'South Supermarket': 125.00, 'Super Metro': 124.25, 'Prince Hypermart': 123.50, 'AllDay': 124.75, 'Lawson': 126.25, 'Circle K': 126.50, 'Uncle John\'s': 125.75, 'Budget Mart': 124.25 } },
            'Del Monte Pineapple Juice (1L)': { avg: 95.00, stores: { '7-Eleven': 97.00, 'Alfamart': 96.00, 'Puregold': 94.00, 'Robinsons Supermarket': 95.00, 'SM Supermarket': 95.50, 'Dali Everyday Grocery': 93.50, 'Savemore': 94.50, 'Shopwise': 94.75, 'Walter Mart': 95.25, 'Rustan\'s': 96.50, 'S&R': 95.00, 'Metro Gaisano': 94.50, 'Gaisano': 94.00, 'South Supermarket': 95.00, 'Super Metro': 94.25, 'Prince Hypermart': 93.50, 'AllDay': 94.75, 'Lawson': 96.25, 'Circle K': 96.50, 'Uncle John\'s': 95.75, 'Budget Mart': 94.25 } },
            'Zesto Juice Drink (200ml x 10)': { avg: 85.00, stores: { '7-Eleven': 87.00, 'Alfamart': 86.00, 'Puregold': 84.00, 'Robinsons Supermarket': 85.00, 'SM Supermarket': 85.50, 'Dali Everyday Grocery': 83.50, 'Savemore': 84.50, 'Shopwise': 84.75, 'Walter Mart': 85.25, 'Rustan\'s': 86.50, 'S&R': 85.00, 'Metro Gaisano': 84.50, 'Gaisano': 84.00, 'South Supermarket': 85.00, 'Super Metro': 84.25, 'Prince Hypermart': 83.50, 'AllDay': 84.75, 'Lawson': 86.25, 'Circle K': 86.50, 'Uncle John\'s': 85.75, 'Budget Mart': 84.25 } },
            'Nestle Fresh Milk (1L)': { avg: 115.00, stores: { '7-Eleven': 117.00, 'Alfamart': 116.00, 'Puregold': 114.00, 'Robinsons Supermarket': 115.00, 'SM Supermarket': 115.50, 'Dali Everyday Grocery': 113.50, 'Savemore': 114.50, 'Shopwise': 114.75, 'Walter Mart': 115.25, 'Rustan\'s': 116.50, 'S&R': 115.00, 'Metro Gaisano': 114.50, 'Gaisano': 114.00, 'South Supermarket': 115.00, 'Super Metro': 114.25, 'Prince Hypermart': 113.50, 'AllDay': 114.75, 'Lawson': 116.25, 'Circle K': 116.50, 'Uncle John\'s': 115.75, 'Budget Mart': 114.25 } },
            'Magnolia Fresh Milk (1L)': { avg: 114.00, stores: { '7-Eleven': 116.00, 'Alfamart': 115.00, 'Puregold': 113.00, 'Robinsons Supermarket': 114.00, 'SM Supermarket': 114.50, 'Dali Everyday Grocery': 112.50, 'Savemore': 113.50, 'Shopwise': 113.75, 'Walter Mart': 114.25, 'Rustan\'s': 115.50, 'S&R': 114.00, 'Metro Gaisano': 113.50, 'Gaisano': 113.00, 'South Supermarket': 114.00, 'Super Metro': 113.25, 'Prince Hypermart': 112.50, 'AllDay': 113.75, 'Lawson': 115.25, 'Circle K': 115.50, 'Uncle John\'s': 114.75, 'Budget Mart': 113.25 } },
            'San Marino Corned Tuna (180g)': { avg: 48.00, stores: { '7-Eleven': 50.00, 'Alfamart': 49.00, 'Puregold': 47.00, 'Robinsons Supermarket': 48.00, 'SM Supermarket': 48.50, 'Dali Everyday Grocery': 46.50, 'Savemore': 47.50, 'Shopwise': 47.75, 'Walter Mart': 48.25, 'Rustan\'s': 49.50, 'S&R': 48.00, 'Metro Gaisano': 47.50, 'Gaisano': 47.00, 'South Supermarket': 48.00, 'Super Metro': 47.25, 'Prince Hypermart': 46.50, 'AllDay': 47.75, 'Lawson': 49.25, 'Circle K': 49.50, 'Uncle John\'s': 48.75, 'Budget Mart': 47.25 } },
            'Young\'s Town Sardines (155g)': { avg: 20.00, stores: { '7-Eleven': 22.00, 'Alfamart': 21.00, 'Puregold': 19.00, 'Robinsons Supermarket': 20.00, 'SM Supermarket': 20.50, 'Dali Everyday Grocery': 18.50, 'Savemore': 19.50, 'Shopwise': 19.75, 'Walter Mart': 20.25, 'Rustan\'s': 21.50, 'S&R': 20.00, 'Metro Gaisano': 19.50, 'Gaisano': 19.00, 'South Supermarket': 20.00, 'Super Metro': 19.25, 'Prince Hypermart': 18.50, 'AllDay': 19.75, 'Lawson': 21.25, 'Circle K': 21.50, 'Uncle John\'s': 20.75, 'Budget Mart': 19.25 } },
            'Ligo Sardines Green (155g)': { avg: 23.00, stores: { '7-Eleven': 25.00, 'Alfamart': 24.00, 'Puregold': 22.00, 'Robinsons Supermarket': 23.00, 'SM Supermarket': 23.50, 'Dali Everyday Grocery': 21.50, 'Savemore': 22.50, 'Shopwise': 22.75, 'Walter Mart': 23.25, 'Rustan\'s': 24.50, 'S&R': 23.00, 'Metro Gaisano': 22.50, 'Gaisano': 22.00, 'South Supermarket': 23.00, 'Super Metro': 22.25, 'Prince Hypermart': 21.50, 'AllDay': 22.75, 'Lawson': 24.25, 'Circle K': 24.50, 'Uncle John\'s': 23.75, 'Budget Mart': 22.25 } }
        };

        const suggestions = Object.keys(mockProducts).slice(0, 12);
        let nearbyStores = [], map, userLocation;

        async function fetchOpenFoodData(query) {
            try {
                const url = `https://ph.openfoodfacts.org/api/v0/product/search?search_terms=${encodeURIComponent(query)}&countries_tags=philippines&fields=product_name,brands,prices&json=1&limit=1`;
                const response = await fetch(url);
                const data = await response.json();
                if (data.count > 0 && data.products[0].prices && data.products[0].prices.length > 0) {
                    const price = data.products[0].prices[0].price;
                    const date = new Date(data.products[0].prices[0].updated_t || Date.now()).toLocaleDateString();
                    return { price: parseFloat(price), brand: data.products[0].brands || 'Generic', source: `Open Food PH (${date})` };
                }
            } catch (error) { console.error(error); }
            return null;
        }

        function initMap(lat = 14.5995, lng = 120.9842) {
            map = L.map('map').setView([lat, lng], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);
        }

        function getLocation() {
            if (navigator.geolocation) {
                document.getElementById('status').innerHTML = '<span class="loading"></span>Locating...';
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                document.getElementById('status').textContent = 'Geolocation not supported. Using Manila.';
                showPosition({ coords: { latitude: 14.5995, longitude: 120.9842 } });
            }
        }

        function showPosition(position) {
            userLocation = { lat: position.coords.latitude, lng: position.coords.longitude };
            document.getElementById('status').innerHTML = '<span class="loading"></span>Location found! Scanning 5km...';
            map.setView([userLocation.lat, userLocation.lng], 13);
            L.marker([userLocation.lat, userLocation.lng]).addTo(map).bindPopup('You').openPopup();
            searchNearbyStores();
        }

        function showError() {
            document.getElementById('status').textContent = 'Using Manila default.';
            userLocation = { lat: 14.5995, lng: 120.9842 };
            initMap();
            searchNearbyStores();
        }

        async function searchNearbyStores() {
            const query = `(7-Eleven OR Alfamart OR "Family Mart" OR MiniStop OR Lawson OR "Circle K" OR "Dali Everyday Grocery" OR Puregold OR "Robinsons Supermarket" OR "SM Supermarket" OR Savemore OR Shopwise OR "Walter Mart" OR Rustan OR "S&R" OR "Metro Gaisano" OR Gaisano OR "South Supermarket" OR "Super Metro" OR "Prince Hypermart" OR AllDay OR "Uncle John\'s" OR "Budget Mart" OR Landers OR Super8 OR "Cash & Carry") around ${userLocation.lat},${userLocation.lng},5000`;
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=30&countrycodes=ph`);
                const results = await response.json();
                nearbyStores = results.map(r => ({
                    name: r.display_name.split(',')[0].replace(/ Supermarket| Hypermarket| Grocery| Store/gi, '').trim() || 'Local Store',
                    lat: parseFloat(r.lat),
                    lng: parseFloat(r.lon),
                    vicinity: r.display_name
                })).filter(s => s.name).slice(0, 25);

                if (nearbyStores.length === 0) throw "no results";
                
                displayStores();
                addStoreMarkers();
                document.getElementById('search-btn').style.display = 'inline-block';
                document.getElementById('status').textContent = `${nearbyStores.length} stores found within 5km!`;
                showSuggestions();
            } catch (error) {
                document.getElementById('status').textContent = 'Using demo stores...';
                nearbyStores = [{ name: '7-Eleven' }, { name: 'Puregold' }, { name: 'SM Supermarket' }, { name: 'Robinsons Supermarket' }, { name: 'Alfamart' }, { name: 'Savemore' }, { name: 'Dali Everyday Grocery' }];
                displayStores();
                document.getElementById('search-btn').style.display = 'inline-block';
                showSuggestions();
            }
        }

        function addStoreMarkers() {
            nearbyStores.forEach(store => {
                L.marker([store.lat, store.lng]).addTo(map).bindPopup(store.name);
            });
        }

        function showSuggestions() {
            const list = document.getElementById('suggestion-list');
            list.innerHTML = '';
            suggestions.forEach(s => {
                const li = document.createElement('li');
                li.textContent = s;
                li.onclick = () => { document.getElementById('search-input').value = s; searchProduct(); };
                list.appendChild(li);
            });
            document.getElementById('suggestions').style.display = 'block';
        }

        function displayStores() {
            const storesList = document.getElementById('stores-list');
            storesList.innerHTML = '';

            nearbyStores.forEach(store => {
                const storeCard = document.createElement('div');
                storeCard.className = 'store-card';

                const storeName = document.createElement('h3');
                storeName.textContent = store.name;
                storeCard.appendChild(storeName);

                const address = document.createElement('p');
                address.innerHTML = `<small>${store.vicinity || 'Nearby'}</small>`;
                storeCard.appendChild(address);

                const officialUrl = storeWebsites[store.name] || `https://www.google.com/search?q=${encodeURIComponent(store.name + " Philippines official website")}`;
                const browseBtn = document.createElement('a');
                browseBtn.href = officialUrl;
                browseBtn.target = "_blank";
                browseBtn.className = "browse-btn";
                browseBtn.textContent = "View All Products on Official Site";
                storeCard.appendChild(browseBtn);

                const productList = document.createElement('ul');
                productList.className = 'product-list';

                Object.keys(mockProducts).slice(0, 5).forEach(productName => {
                    const productItem = document.createElement('li');
                    productItem.className = 'product-item';
                    const price = mockProducts[productName].stores[store.name] || mockProducts[productName].avg || 50;
                    const variedPrice = (price + (Math.random() - 0.5) * 2).toFixed(2);
                    productItem.innerHTML = `<strong>${productName}:</strong> ₱${variedPrice}`;
                    productList.appendChild(productItem);
                });
                storeCard.appendChild(productList);

                storesList.appendChild(storeCard);
            });
        }

        async function searchProduct() {
            const query = document.getElementById('search-input').value.trim().toLowerCase();
            if (!query || nearbyStores.length === 0) return;

            const loading = document.getElementById('loading');
            const comparisonSection = document.getElementById('comparison-section');
            const searchTerm = document.getElementById('search-term');
            const tableBody = document.getElementById('comparison-table-body');
            tableBody.innerHTML = '';
            loading.style.display = 'inline-block';
            comparisonSection.style.display = 'block';
            searchTerm.textContent = query;

            let foundProduct = Object.keys(mockProducts).find(p => p.toLowerCase().includes(query));
            if (!foundProduct) foundProduct = query;

            for (const store of nearbyStores) {
                const realData = await fetchOpenFoodData(foundProduct);
                let price = realData ? realData.price : (mockProducts[foundProduct]?.stores[store.name] || mockProducts[foundProduct]?.avg || 50);
                let brand = realData?.brand || foundProduct.split(' ')[0];
                let source = realData?.source || "2025 avg";

                const row = document.createElement('tr');
                row.innerHTML = `<td>${store.name}</td><td>${brand}</td><td>₱${price.toFixed(2)}</td><td>${source}</td>`;
                tableBody.appendChild(row);
            }

            const prices = Array.from(tableBody.querySelectorAll('tr td:nth-child(3)')).map(td => parseFloat(td.textContent.slice(1)));
            const lowest = Math.min(...prices);
            tableBody.querySelectorAll('tr').forEach(tr => {
                if (parseFloat(tr.cells[2].textContent.slice(1)) === lowest) tr.cells[2].classList.add('lowest-price');
            });

            loading.style.display = 'none';
        }

        document.getElementById('locate-btn').addEventListener('click', getLocation);
        document.getElementById('search-btn').addEventListener('click', searchProduct);
        document.getElementById('search-input').addEventListener('keypress', e => { if (e.key === 'Enter') searchProduct(); });

        window.addEventListener('load', () => {
            initMap();
            showSuggestions();
        });
    </script>
</body>
</html>
