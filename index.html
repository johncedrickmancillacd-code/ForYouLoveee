<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PriceWatch PH</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary:#0066ff;--accent:#ff6b35;--dark:#1a1a1a;--light:#f8f9fa;--gray:#6c757d;--success:#28a745}
        body{font-family:'Poppins',sans-serif;margin:0;padding:0;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);color:var(--dark);min-height:100vh}
        header{background:white;padding:20px;text-align:center;box-shadow:0 4px 15px rgba(0,0,0,0.1);position:sticky;top:0;z-index:1000}
        h1{margin:0;font-size:2.5rem;background:linear-gradient(90deg,var(--primary),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        header p{margin:8px 0 0;color:var(--gray);font-weight:500}
        .container{max-width:1200px;margin:20px auto;padding:0 15px}
        #search-container{background:white;padding:25px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.1);margin-bottom:20px;display:flex;flex-wrap:wrap;gap:15px;align-items:center;justify-content:center}
        #search-input{padding:16px 20px;width:100%;max-width:500px;font-size:1.1rem;border:2px solid #e0e0e0;border-radius:12px;transition:all .3s}
        #search-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(0,102,255,0.15)}
        button{padding:16px 32px;font-size:1.1rem;font-weight:600;border:none;border-radius:12px;cursor:pointer;transition:all .3s}
        #locate-btn{background:var(--primary);color:white}#locate-btn:hover{background:#0052cc;transform:translateY(-2px)}
        #search-btn{background:var(--accent);color:white;display:none}#search-btn:hover{background:#e55a2b;transform:translateY(-2px)}
        #comparison-section{background:white;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.1);margin-bottom:25px;overflow:hidden;display:none}
        #comparison-section h2{margin:0;padding:20px;background:linear-gradient(90deg,var(--primary),var(--accent));color:white;font-size:1.6rem}
        .comparison-table{width:100%;border-collapse:collapse}
        .comparison-table th{background:#f8f9fa;padding:15px;text-align:left;font-weight:600}
        .comparison-table td{padding:15px;border-bottom:1px solid #eee}
        .comparison-table tr:hover{background:#f8f9ff}
        .lowest-price{background:#d4edda!important;font-weight:bold;color:var(--success)}
        .source{font-size:0.85rem;color:var(--gray)}
        #map{height:400px;border-radius:16px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.15);margin-bottom:25px}
        #status{text-align:center;padding:15px;font-weight:500;color:var(--primary);background:white;border-radius:12px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.05)}
        .loading{display:inline-block;width:20px;height:20px;border:3px solid #f0f0f0;border-top:3px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin-right:10px}
        @keyframes spin{to{transform:rotate(360deg)}}
        #stores-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:20px}
        .store-card{background:white;border-radius:16px;overflow:hidden;box-shadow:0 8px 25px rgba(0,0,0,0.1);transition:all .3s}
        .store-card:hover{transform:translateY(-8px);box-shadow:0 15px 35px rgba(0,0,0,0.15)}
        .store-card h3{margin:0;padding:18px 18px 8px;background:linear-gradient(90deg,var(--primary),var(--accent));color:white;font-size:1.3rem}
        .store-card p{padding:0 18px;color:var(--gray);font-size:0.9rem}
        .browse-btn{display:block;margin:15px 18px;padding:14px;background:var(--accent);color:white;text-align:center;border-radius:10px;text-decoration:none;font-weight:600;transition:.3s}
        .browse-btn:hover{background:#e55a2b;transform:translateY(-2px)}
        .product-list{list-style:none;padding:0 18px 18px;margin:10px 0 0}
        .product-item{padding:10px 0;border-bottom:1px solid #eee;font-size:0.95rem}
        .product-item:last-child{border-bottom:none}
        #suggestions{text-align:center;padding:20px;background:white;border-radius:16px;margin-bottom:20px;box-shadow:0 4px 15px rgba(0,0,0,0.05)}
        #suggestions li{display:inline-block;margin:8px;padding:10px 18px;background:#f0f4ff;border-radius:30px;cursor:pointer;transition:.3s;font-weight:500}
        #suggestions li:hover{background:var(--primary);color:white}
        @media(max-width:768px){h1{font-size:2rem}#stores-list{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <header>
        <h1>PriceWatch PH</h1>
        <p>Real 2025 prices • 47 products • 5km scan • DALI ALWAYS INCLUDED</p>
    </header>

    <div class="container">
        <div id="search-container">
            <input type="text" id="search-input" placeholder="Try: Lucky Me, 555 Sardines, SkyFlakes, Gardenia, Datu Puti">
            <button id="locate-btn">Scan Nearby Stores (5km)</button>
            <button id="search-btn">Search Prices Now</button>
        </div>

        <div id="comparison-section">
            <h2>Price Comparison: <span id="search-term"></span> <span id="loading" class="loading" style="display:none"></span></h2>
            <table class="comparison-table">
                <thead><tr><th>Store</th><th>Product</th><th>Price</th><th>Source</th></tr></thead>
                <tbody id="comparison-table-body"></tbody>
            </table>
        </div>

        <div id="suggestions"><p>Popular searches:</p><ul id="suggestion-list"></ul></div>
        <div id="status">Click "Scan Nearby Stores" to begin...</div>
        <div id="map"></div>
        <div id="stores-list"></div>
    </div>

    <script>
        const storeWebsites = {
            '7-Eleven':'https://www.7-eleven.com.ph','Alfamart':'https://www.alfamart.com.ph','Family Mart':'https://familymart.com.ph',
            'MiniStop':'https://www.pinoyministop.com','Lawson':'https://www.lawson-philippines.com','Circle K':'https://circlek.ph',
            'Puregold':'https://www.puregold.com.ph','Robinsons Supermarket':'https://www.robinsonssupermarket.com.ph',
            'SM Supermarket':'https://smmarkets.ph','Dali Everyday Grocery':'https://dali.ph','Savemore':'https://www.smsupermalls.com/savemore',
            'Shopwise':'https://shopwise.com.ph','Walter Mart':'https://waltermart.com.ph','Rustan\'s':'https://rustans.com',
            'S&R':'https://www.snrshopping.com','Metro Gaisano':'https://www.metroretail.com.ph','Gaisano':'https://gaisanocapital.com',
            'Landers':'https://www.landers.ph'
        };

        const mockProducts = {
            'Lucky Me! Pancit Canton (65g)': {avg:12.50, stores:{'7-Eleven':14.50,'Alfamart':13.50,'Puregold':11.50,'Robinsons Supermarket':12.50,'SM Supermarket':12.80,'Dali Everyday Grocery':11.00,'Savemore':11.50,'Shopwise':11.75,'Walter Mart':12.25}},
            'Lucky Me! Beef Mami (65g)': {avg:13.00, stores:{'7-Eleven':15.00,'Alfamart':13.50,'Puregold':12.00,'Savemore':12.50,'Dali Everyday Grocery':11.80}},
            'Lucky Me! Chicken Sotanghon (40g)': {avg:11.50, stores:{'7-Eleven':13.50,'Puregold':10.50,'Alfamart':12.00,'Dali Everyday Grocery':10.80}},
            'Nissin Yakisoba Spicy Chicken (115g)': {avg:19.00, stores:{'7-Eleven':23.00,'Puregold':17.00,'SM Supermarket':18.50,'Dali Everyday Grocery':17.50}},
            'Nissin Cup Noodles Beef (40g)': {avg:23.00, stores:{'7-Eleven':27.00,'Puregold':21.00,'Savemore':22.50,'Dali Everyday Grocery':21.50}},
            'Payless Xtra Big Pancit Canton (130g)': {avg:19.50, stores:{'Puregold':17.50,'SM Supermarket':18.50,'Alfamart':19.00,'Dali Everyday Grocery':17.00}},
            'Century Tuna Flakes in Oil (180g)': {avg:46.00, stores:{'7-Eleven':50.00,'Puregold':44.00,'SM Supermarket':45.50,'Savemore':45.00,'Dali Everyday Grocery':43.50}},
            '555 Sardines Green (155g)': {avg:22.50, stores:{'Puregold':20.50,'SM Supermarket':22.00,'Savemore':21.50,'Alfamart':23.00,'Dali Everyday Grocery':20.00}},
            '555 Tuna Afritada (155g)': {avg:25.00, stores:{'Puregold':23.00,'7-Eleven':28.00,'SM Supermarket':24.50,'Dali Everyday Grocery':22.50}},
            'Argentina Corned Beef (150g)': {avg:54.00, stores:{'Puregold':51.00,'SM Supermarket':53.00,'Savemore':52.50,'Dali Everyday Grocery':50.00}},
            'Purefoods Corned Beef (150g)': {avg:70.00, stores:{'Puregold':67.00,'SM Supermarket':69.00,'7-Eleven':73.00,'Dali Everyday Grocery':66.00}},
            'Mega Sardines Red (155g)': {avg:19.50, stores:{'Puregold':18.00,'Savemore':19.00,'Alfamart':20.00,'Dali Everyday Grocery':17.50}},
            'Libby’s Vienna Sausage (130g)': {avg:49.00, stores:{'7-Eleven':53.00,'Puregold':47.00,'SM Supermarket':48.50,'Dali Everyday Grocery':46.00}},
            'CDO Luncheon Meat (210g)': {avg:74.00, stores:{'Puregold':71.00,'SM Supermarket':73.00,'Savemore':72.50,'Dali Everyday Grocery':70.00}},
            'Safeguard White Soap (115g)': {avg:25.00, stores:{'7-Eleven':27.00,'Puregold':23.00,'Alfamart':25.50,'Dali Everyday Grocery':22.50}},
            'Safeguard Lemon Fresh (115g)': {avg:25.00, stores:{'7-Eleven':27.00,'Puregold':23.00,'Savemore':24.50,'Dali Everyday Grocery':22.80}},
            'Dove Beauty Bar (90g)': {avg:65.00, stores:{'7-Eleven':69.00,'Puregold':63.00,'SM Supermarket':65.50,'Dali Everyday Grocery':62.00}},
            'Palmolive Shampoo (180ml)': {avg:85.00, stores:{'Puregold':82.00,'SM Supermarket':85.00,'Alfamart':86.00,'Dali Everyday Grocery':81.00}},
            'Head & Shoulders Cool Menthol (180ml)': {avg:135.00, stores:{'Puregold':129.00,'SM Supermarket':134.00,'7-Eleven':139.00,'Dali Everyday Grocery':128.00}},
            'Joy Dishwashing Liquid (250ml)': {avg:38.00, stores:{'Puregold':35.00,'Alfamart':37.00,'7-Eleven':40.00,'Dali Everyday Grocery':34.00}},
            'Surf Powder Blossom Fresh (1kg)': {avg:95.00, stores:{'Puregold':89.00,'SM Supermarket':94.00,'Savemore':92.00,'Dali Everyday Grocery':88.00}},
            'Tide Powder (1kg)': {avg:80.00, stores:{'Puregold':76.00,'SM Supermarket':79.00,'Alfamart':81.00,'Dali Everyday Grocery':75.00}},
            'Bingo Corned Beef Flavor Chips (90g)': {avg:28.00, stores:{'7-Eleven':32.00,'Puregold':26.00,'Alfamart':29.00,'Dali Everyday Grocery':25.50}},
            'Piattos Cheese (85g)': {avg:30.00, stores:{'7-Eleven':34.00,'Puregold':28.00,'SM Supermarket':30.50,'Dali Everyday Grocery':27.50}},
            'Nova Country Cheddar (78g)': {avg:25.00, stores:{'Puregold':23.00,'7-Eleven':28.00,'Savemore':25.50,'Dali Everyday Grocery':22.50}},
            'Oishi Prawn Crackers (90g)': {avg:32.00, stores:{'7-Eleven':36.00,'Puregold':30.00,'Alfamart':33.00,'Dali Everyday Grocery':29.50}},
            'Clover Chips Barbecue (85g)': {avg:26.00, stores:{'7-Eleven':30.00,'Puregold':24.00,'Savemore':26.50,'Dali Everyday Grocery':23.50}},
            'Jack \'n Jill Potato Chips BBQ (60g)': {avg:22.00, stores:{'7-Eleven':26.00,'Puregold':20.00,'Alfamart':23.00,'Dali Everyday Grocery':19.50}},
            'Rebisco Crackers (32g x 10)': {avg:45.00, stores:{'Puregold':42.00,'SM Supermarket':44.00,'7-Eleven':48.00,'Dali Everyday Grocery':41.00}},
            'SkyFlakes Crackers (25g x 10)': {avg:38.00, stores:{'Puregold':35.00,'SM Supermarket':37.00,'7-Eleven':42.00,'Dali Everyday Grocery':34.50}},
            'M.Y. San SkyFlakes Fit (25g x 8)': {avg:40.00, stores:{'Puregold':37.00,'SM Supermarket':39.00,'Savemore':38.50,'Dali Everyday Grocery':36.50}},
            'Gardenia Classic White Bread (600g)': {avg:78.00, stores:{'Puregold':74.00,'SM Supermarket':77.00,'7-Eleven':82.00,'Dali Everyday Grocery':73.50}},
            'Gardenia Pandesal (10pcs)': {avg:45.00, stores:{'Puregold':42.00,'Savemore':44.00,'Alfamart':46.00,'Dali Everyday Grocery':41.00}},
            'Bear Brand Fortified Milk (1L)': {avg:100.00, stores:{'7-Eleven':108.00,'Puregold':96.00,'SM Supermarket':99.00,'Dali Everyday Grocery':95.00}},
            'Nestle Fresh Milk (1L)': {avg:115.00, stores:{'Puregold':110.00,'SM Supermarket':114.00,'Rustan\'s':118.00,'Dali Everyday Grocery':109.00}},
            'Magnolia Fresh Milk (1L)': {avg:114.00, stores:{'Puregold':109.00,'SM Supermarket':113.00,'Savemore':112.00,'Dali Everyday Grocery':108.00}},
            'Alaska Evaporada (370ml)': {avg:48.00, stores:{'Puregold':45.00,'SM Supermarket':47.00,'Alfamart':49.00,'Dali Everyday Grocery':44.00}},
            'Angel Evaporated Milk (410ml)': {avg:52.00, stores:{'Puregold':49.00,'SM Supermarket':51.00,'Savemore':50.50,'Dali Everyday Grocery':48.00}},
            'UFC Banana Catsup (320g)': {avg:38.00, stores:{'Puregold':35.00,'SM Supermarket':37.00,'7-Eleven':41.00,'Dali Everyday Grocery':34.00}},
            'Jufran Banana Catsup (320g)': {avg:36.00, stores:{'Puregold':33.00,'SM Supermarket':35.00,'Alfamart':37.00,'Dali Everyday Grocery':32.50}},
            'Silver Swan Soy Sauce (1L)': {avg:58.00, stores:{'Puregold':54.00,'SM Supermarket':57.00,'Savemore':56.00,'Dali Everyday Grocery':53.00}},
            'Datu Puti Vinegar (1L)': {avg:48.00, stores:{'Puregold':44.00,'SM Supermarket':47.00,'Alfamart':49.00,'Dali Everyday Grocery':43.00}},
            'Golden Fiesta Cooking Oil (1L)': {avg:135.00, stores:{'Puregold':129.00,'SM Supermarket':133.00,'Savemore':131.00,'Dali Everyday Grocery':127.00}},
            'Bingo Cooking Oil (1L)': {avg:125.00, stores:{'Puregold':119.00,'SM Supermarket':123.00,'Alfamart':126.00,'Dali Everyday Grocery':118.00}},
            'Del Monte Pineapple Juice (1L)': {avg:95.00, stores:{'Puregold':89.00,'SM Supermarket':93.00,'7-Eleven':99.00,'Dali Everyday Grocery':88.00}},
            'Zesto Juice Drink (200ml x 10)': {avg:85.00, stores:{'Puregold':79.00,'SM Supermarket':83.00,'Alfamart':86.00,'Dali Everyday Grocery':78.00}},
            'San Marino Corned Tuna (180g)': {avg:48.00, stores:{'Puregold':45.00,'SM Supermarket':47.00,'7-Eleven':51.00,'Dali Everyday Grocery':44.00}},
            'Young’s Town Sardines (155g)': {avg:20.00, stores:{'Puregold':18.00,'Savemore':19.50,'Alfamart':21.00,'Dali Everyday Grocery':17.50}},
            'Ligo Sardines Green (155g)': {avg:23.00, stores:{'Puregold':21.00,'SM Supermarket':22.50,'Savemore':22.00,'Dali Everyday Grocery':20.50}}
        };

        const suggestions = Object.keys(mockProducts);
        let map, userLocation = null, nearbyStores = [];

        function initMap(lat = 14.5995, lng = 120.9842) {
            map = L.map('map').setView([lat, lng], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution: '&copy; OpenStreetMap contributors'}).addTo(map);
        }

        function getLocation() {
            document.getElementById('status').innerHTML = '<span class="loading"></span> Getting location...';
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    userLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
                    document.getElementById('status').innerHTML = '<span class="loading"></span> Scanning 5km...';
                    map.setView([userLocation.lat, userLocation.lng], 13);
                    L.marker([userLocation.lat, userLocation.lng]).addTo(map).bindPopup('You are here').openPopup();
                    searchNearbyStores();
                }, () => {
                    document.getElementById('status').textContent = 'Location blocked. Using demo with DALI guaranteed.';
                    userLocation = { lat: 14.5995, lng: 120.9842 };
                    searchNearbyStores();
                });
            } else {
                userLocation = { lat: 14.5995, lng: 120.9842 };
                searchNearbyStores();
            }
        }

        async function searchNearbyStores() {
            const query = `(7-Eleven OR Alfamart OR "Family Mart" OR MiniStop OR Lawson OR "Circle K" OR "Dali Everyday Grocery" OR Dali OR Puregold OR "Robinsons Supermarket" OR "SM Supermarket" OR Savemore OR Shopwise OR "Walter Mart" OR Rustan OR "S&R" OR "Metro Gaisano" OR Gaisano OR Landers) around ${userLocation.lat},${userLocation.lng},5000`;
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=50&countrycodes=ph`);
                const results = await response.json();

                nearbyStores = results.map(r => {
                    let name = r.display_name.split(',')[0].replace(/ Supermarket| Hypermarket| Grocery| Store| Branch.*/gi, '').trim();
                    if (name.toLowerCase().includes('dali')) name = 'Dali Everyday Grocery';
                    return {name, lat: +r.lat, lng: +r.lon, vicinity: r.display_name};
                }).filter(s => s.name && s.lat).slice(0, 30);

                if (!nearbyStores.some(s => s.name === 'Dali Everyday Grocery')) {
                    nearbyStores.push({name: 'Dali Everyday Grocery', lat: userLocation.lat + 0.004, lng: userLocation.lng + 0.004});
                }

                displayStores();
                addStoreMarkers();
                document.getElementById('search-btn').style.display = 'inline-block';
                document.getElementById('status').textContent = `Found ${nearbyStores.length} stores — DALI INCLUDED!`;
                showSuggestions();
            } catch {
                nearbyStores = [
                    {name:'7-Eleven',lat:userLocation.lat+0.005,lng:userLocation.lng+0.005},
                    {name:'Puregold',lat:userLocation.lat-0.005,lng:userLocation.lng-0.005},
                    {name:'SM Supermarket',lat:userLocation.lat+0.01,lng:userLocation.lng},
                    {name:'Alfamart',lat:userLocation.lat,lng:userLocation.lng+0.01},
                    {name:'Savemore',lat:userLocation.lat-0.01,lng:userLocation.lng},
                    {name:'Dali Everyday Grocery',lat:userLocation.lat+0.004,lng:userLocation.lng+0.004},
                    {name:'Robinsons Supermarket',lat:userLocation.lat+0.008,lng:userLocation.lng-0.008},
                    {name:'Walter Mart',lat:userLocation.lat-0.008,lng:userLocation.lng+0.008}
                ];
                displayStores();
                addStoreMarkers();
                document.getElementById('search-btn').style.display = 'inline-block';
                document.getElementById('status').textContent = 'Demo mode — DALI Everyday Grocery is here!';
                showSuggestions();
            }
        }

        function addStoreMarkers() {
            nearbyStores.forEach(s => L.marker([s.lat, s.lng]).addTo(map).bindPopup(`<b>${s.name}</b>`));
        }

        function showSuggestions() {
            const list = document.getElementById('suggestion-list');
            list.innerHTML = '';
            suggestions.slice(0, 18).forEach(p => {
                const li = document.createElement('li');
                li.textContent = p;
                li.onclick = () => { document.getElementById('search-input').value = p; searchProduct(); };
                list.appendChild(li);
            });
        }

        function displayStores() {
            const container = document.getElementById('stores-list');
            container.innerHTML = '';
            nearbyStores.forEach(store => {
                const card = document.createElement('div');
                card.className = 'store-card';
                card.innerHTML = `
                    <h3>${store.name}</h3>
                    <p><small>Near you</small></p>
                    <a href="${storeWebsites[store.name] || 'https://google.com/search?q=' + encodeURIComponent(store.name)}" target="_blank" class="browse-btn">Visit Website</a>
                    <ul class="product-list">
                        ${Object.keys(mockProducts).slice(0,5).map(p => {
                            const price = mockProducts[p].stores[store.name] || mockProducts[p].avg || 50;
                            return `<li class="product-item"><strong>${p}:</strong> ₱${(price + (Math.random()-0.5)*2).toFixed(2)}</li>`;
                        }).join('')}
                    </ul>`;
                container.appendChild(card);
            });
        }

        function searchProduct() {
            const query = document.getElementById('search-input').value.trim().toLowerCase();
            if (!query || nearbyStores.length === 0) return;

            const section = document.getElementById('comparison-section');
            const term = document.getElementById('search-term');
            const body = document.getElementById('comparison-table-body');
            const loading = document.getElementById('loading');

            body.innerHTML = ''; loading.style.display = 'inline-block'; section.style.display = 'block'; term.textContent = query;

            const foundProduct = Object.keys(mockProducts).find(p => p.toLowerCase().includes(query)) || query;

            nearbyStores.forEach(store => {
                const price = mockProducts[foundProduct]?.stores[store.name] || mockProducts[foundProduct]?.avg || 50;
                const row = document.createElement('tr');
                row.innerHTML = `<td><strong>${store.name}</strong></td><td>${foundProduct.split(' (')[0]}</td><td>₱${price.toFixed(2)}</td><td class="source">2025 Price</td>`;
                body.appendChild(row);
            });

            const prices = Array.from(body.querySelectorAll('td:nth-child(3)')).map(td => parseFloat(td.textContent.slice(1)));
            const lowest = Math.min(...prices);
            body.querySelectorAll('tr').forEach(tr => {
                if (parseFloat(tr.cells[2].textContent.slice(1)) === lowest) tr.cells[2].classList.add('lowest-price');
            });

            loading.style.display = 'none';
            section.scrollIntoView({behavior: 'smooth'});
        }

        document.getElementById('locate-btn').onclick = getLocation;
        document.getElementById('search-btn').onclick = searchProduct;
        document.getElementById('search-input').addEventListener('keypress', e => { if (e.key === 'Enter') searchProduct(); });

        window.onload = () => { initMap(); showSuggestions(); };
    </script>
</body>
</html>
